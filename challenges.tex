%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Rulebook RoboCup Logisitc League
%% 2021 Challenges
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% chktex-file 29
\documentclass[12pt,twoside]{article}
\usepackage[a4paper]{anysize}
\marginsize{2cm}{2cm}{1cm}{2cm}

\setlength{\marginparwidth}{1cm}
%\usepackage{fourier}

\usepackage{floatpag}
\usepackage{wrapfig}
\usepackage{fnpct}

\usepackage[table]{xcolor}

\usepackage[binary-units=true]{siunitx}
%% HYPERREF %%%%%%%%%%%%%%%%%%%
\usepackage{hyperref}
\hypersetup{
  pdftitle      = {The RoboCup Logistics League Challenge Rulebook for 2021},
  pdfauthor     = {RCLL TC},
  pdfkeywords   = {RCLL, Rulebook, Challenges},
  pdfsubject    = {},
  hidelinks,
}
\usepackage{tabularx}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{calc}
\usepackage{float}
\usepackage{hhline}
\usepackage{longtable}

\restylefloat{table}
%% INPUTENC %%%%%%%%%%%%%%%%%%%
\usepackage{wasysym}
\usepackage[utf8]{inputenc}
\input{macros.tex}

\newcolumntype{C}{>{\raggedright\arraybackslash}X}

\newcommand{\refsec}[1]{Section~\ref{#1}}
\newcommand{\reffig}[1]{Figure~\ref{#1}}
\newcommand{\refdef}[1]{Definition~\ref{#1}}
%\newcommand{\reflst}[1]{Listing~\ref{#1}}
\newcommand{\reflst}[1]{Figure~\ref{#1}}
\newcommand{\reftab}[1]{Table~\ref{#1}}
\usepackage{acronym}
\acrodef{BS}{base station}
\acrodef{CS}{cap station}
\acrodef{RS}{ring station}
\acrodef{SS}{storage station}
\acrodef{DS}{delivery station}
\acrodef{RCLL}{RoboCup Logistics Leaugue}
\acrodef{TBD}{To be Discussed}

\usepackage{todonotes}
\presetkeys%
    {todonotes}%
    {inline}{}
\begin{document}
\begin{titlepage}
  \vspace*{5cm}
  \begin{center}
    \begin{LARGE}

      {\bf RoboCup Logistics League}\\[2ex]
			{\Large \bf{Challenges}}\\[4ex]
      {\Large Rules and Regulations 2021}\\[4ex]
    \end{LARGE}
    \hrule

    {\LARGE\vspace*{4ex}}
    \begin{Large}
      The Technical Committee 2012--2021\\[6ex]
    \end{Large}
    \begin{tabular}{lll}
      \textbf{Vincent Coelen}&\textbf{Christian Deppe}&\textbf{Mostafa Gomaa}\\
      \textbf{Till Hofmann}&\textbf{Ulrich Karras}&\textbf{Tim Niemueller}\\
			\textbf{Alain Rohr}&\textbf{Thomas Ulz}&\textbf{Tarik Viehmann}\\[.5em]

      Daniel Ewert&Nils Harder&S\"oren Jentzsch\\
      Nicolas Meier&Sebastian Reuter&Wataru Uemura\\
      Gerald Steinbauer&Tobias Neumann\\
    \end{tabular}
    \vfill
		Revision Date: \ac{TBD}\\
		DRAFT: Work in Progress %chktex 13
			\todo{is this up-to-date?}
  \end{center}
\end{titlepage}


\section{Introduction}
\label{sec:intro}
Our aim is to capture the main tasks from the RoboCup Logistics League in
isolated challenges, which form an additional competition in the league.
Main objectives of this new competition are:
\begin{itemize}
	\item to provide a framework that allows teams to show and evaluate their
		progress in the individual tasks of the RCLL
	\item to ease the preparation for the main competition through providing a
		simplified cost- and space-efficient setup suitable for replication in
		local labs
	\item to be attractive for both RoboCup live events and online competitions,
		where teams can participate remotely from all over the world
\end{itemize}

\section{Competition Area}
\subsection{Field Layout}
The competition area for the main challenges consists of a \SI{5 x 5}{\metre}
area divided in square zones of \SI{1 x 1}{\metre}. Additional challenges that
are not counting towards the scoring of the competition are carried out on
a \SI{7 x 8}{\metre} field instead (corresponding to halve the field of the
regular \ac{RCLL} field).

\todo{add picture of field with zone names}

The entire area belongs to a single team. The bottom left-most
\SI{1 x 3}{\metre} area is called the insertion zone, It does not need to have
partial walls around it and provides the starting positions for up to three
robots.
\subsection{Remote Layout}
\todo{some sort of camera arrangement needed to stream, rules for humans on
field etc.}
\subsection{Machines}
Mockup machines are required to have the same dimensions as specified
 in the RCLL rulebook section \textbf{3.2 Machines}.
The building material has to be opaque, the station can be painted
 grey to reflect its actual color.\newline
On each mockup station a conveyor model has to be mounted.
The model can be found in \textit{mock\_up\_models/conveyor.dae}.
The building material has to be opaque, the conveyor belt can be
 painted black to reflect its actual color.\newline
A model of the shelf is provided as well, mounting a shelf model
 is required in order to mock up a \ac{CS}.
In order to compete in all main challenges, a minimum number of 3 mockup
machines are required. On higher difficulty some challenges may require
4 mockup stations and some secondary challenges require 7 stations.

A mockup machine resembling a \ac{RS} does not need to have (mockup) slide
attached. Instead, no challenge involves slide usage.
\section{Game Play}
\subsection{Competition Scope}
\todo{X time slots of 10 minute setup time per team, followed by up to 20
	minutes of game time. Each slot can be used to solve
at most one challenge, a team can decide to fail a challenge and use another
slot to improve.
A team can use a single slot to try a challenge multiple times (with the same
field layout) once a challenge counts, it cannot be attempted again
(unless difficulty is increased).}

The delivery procedure for finished products is altered compared to the
\ac{RCLL} rule set. In order to reduce the amount of mockup machines required
for participation, Deliveries are made by bringing the finished product
to the insertion zone and dropping it there.

All challenges (unless stated otherwise) are conducted while measuring
the execution time. The execution time is measured by the RefBox.
The fastest team in any challenge gains additional points.

\subsection{Field Operators}
In challenges where machines are instructed, the actual assembly has to be
performed by human supervisors. Whenever a machine is instructed, the RefBox
operator announces the required interaction. One field operator may proceed
to enter the field in order to perform the interaction. Afterwards the field
has to be left immediately.
\todo{replenisher not necessary for challenges?}
\todo{maintenance rules}

\subsection{Available Challenges for the Primary Competition}
Challenges have different types and variations (difficulty levels).
The overall score of the competition is calculated by summing up the score
in the highest difficulty achieved in each of the challenge types.
The challenge types of the competition are described in
\refsec{sec:challenge-navigation}-\ref{sec:challenge-markerless}

The RefBox is used to log the scores and data for each challenge.
Todo: implement challenges in refbox, provide tool to evaluate results

\subsubsection{Navigation Challenge}\label{sec:challenge-navigation}
Basic navigation task with known obstacles.\\
\textbf{Task:} Drives a route starting and ending in the insertion zone while
covering a given set of target positions. Return to insertion zone when done.\\
Variations of this challenge depend
on the number of repetitions, the field layout and the number of
available machines (see \reftab{tab:challenge-navigation}).
Multiple robots may be used to repition

\begin{table}[!htb]
    \centering
        \begin{tabularx}{\linewidth}{l|l|l|l}
					Field Size & Machines & Repetitions & Scoring \\\hline
					\SI{5 x 5}{\metre} & $ 2$ & $x\in [1,2,3]$ & $5 + (5\cdot x)$ \\
					\SI{5 x 5}{\metre} & $ 3$ & $x\in [1,2,3]$ & $10 + (5\cdot x)$ \\
					\SI{5 x 5}{\metre} & $ 4$ & $x\in [1,2,3]$ & $15 + (5\cdot x)$ \\
					%\SI{7 x 8}{\metre} & $ 7$ & 3 & 40 \\
        \end{tabularx}
    \caption{Navigation Challenge}
    \label{tab:challenge-navigation}
\end{table}

\subsubsection{Exploration Challenge}\label{sec:challenge-exploration}
Replicate the RCLL exploration phase.
Machine Marker detection as well as navigational skills are required to solve
this challenge.\\
\textbf{Task:} Find and report all machines on the field (type and orientation).
\\
Variable in the number of machines
(see \reftab{tab:challenge-exploration}).
\begin{table}[!htb]
    \centering
        \begin{tabularx}{\linewidth}{l|l|l}
					Field Size & Machines & Scoring \\\hline
					\SI{5 x 5}{\metre} & $ 2$   & $10$ \\
					\SI{5 x 5}{\metre} & $ 3$   & $20$  \\
					\SI{5 x 5}{\metre} & $ 4$   & $30$  \\
					%\SI{7 x 8}{\metre} & $ 7$   & $30$  \\
        \end{tabularx}
    \caption{Exploration Challenge}
    \label{tab:challenge-exploration}
\end{table}


\subsubsection{Grasping Challenge}\label{sec:challenge-grasping}
Simple grasping task.
Each Machine has a base at output.
Robots start at cell in front of a machine output.\\
\textbf{Task:} A robot brings a base from one machine's output back to it's
input. Once all products are at the input sides of all machines and all robots
returned to their starting positions.\\
\todo{improve description}
Variations differ by number of machines and Repetitions, see
\reftab{tab:challenge-grasping}.

\begin{table}[!htb]
    \centering
        \begin{tabularx}{\linewidth}{l|l|l|l}
					Field Size & Machines & Repetitions & Scoring \\\hline
					\SI{5 x 5}{\metre} & 1 & $x\in [1,2,3]$  & $10+(x\cdot 2)$ \\
					\SI{5 x 5}{\metre} & 2  & $x\in [1,2,3]$ & $20+(x\cdot 3)$ \\
					\SI{5 x 5}{\metre} & 3  & $x\in [1,2,3]$ & $30+(x\cdot 5)$
        \end{tabularx}
    \caption{Grasping Challenge}
    \label{tab:challenge-grasping}
\end{table}

\subsubsection{Product Challenges}\label{sec:challenge-cx}
This section covers four types of challenges, instead of just a single one.
Each challenge corresponds to the production of a product with one of the
available complexities (C0, C1, C2, C3) in the \ac{RCLL}.\\
\textbf{Task:} Produce all posted orders.\\
\todo{Variants with multiple orders or with two ring stations? Webshop?}
Scoring is shown in \reftab{tab:challenge-cx}.
\begin{table}[!htb]
    \centering
        \begin{tabularx}{\linewidth}{l|l|l|l}
					Field Size & Machines & Challenge type & Scoring \\\hline
					\SI{5 x 5}{\metre} & 2 & C0 & 30\\
					\SI{5 x 5}{\metre} & 3  & C1 & 50 \\
					\SI{5 x 5}{\metre} & 3 & C2 & 70 \\
					\SI{5 x 5}{\metre} & 3 & C3 & 100 \\
        \end{tabularx}
    \caption{CX Challenge}
    \label{tab:challenge-cx}
\end{table}

\subsubsection{Markerless Detection Challenge}\label{sec:markerless}
Image recognition challenge to classify different machine types.\\
\textbf{Task:} Autonomously label the machines shown in a set of pictures\\
As a preparation for this challenge, a data set will be supplied to
all participants which may be used for training and testing purposes.
The evaluation set for the challenge consists of a set of separate images.
\todo{pictures with multiple machines}
\begin{table}[!htb]
    \centering
        \begin{tabularx}{\linewidth}{l|l|l|l}
					 \% Correctly Classified & \% Wrongly Classified & \% Not Classified
																	 & Scoring \\\hline
					 $x$ & $y$ & $z$ & $(x-y)\cdot30$
        \end{tabularx}
    \caption{Machine Detection Challenge}
    \label{tab:challenge-markerless}
\end{table}

\subsection{Challenges for the Secondary Competition}

\subsubsection{Full game}\label{sec:challenge-full-game}
Play a full RCLL game on a field of \SI{7 x 8}{\metre} with $7$ machines
(no machines from the opposing team).
\todo{relax no-payment and delivery assumption?}
\end{document}
